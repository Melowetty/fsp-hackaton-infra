{
    # Глобальные настройки безопасности
    security {
        authentication portal my_auth_portal {
            jwt {
                token_name "Bearer"
                token_secret "your_strong_jwt_secret_here"  # Должен совпадать с Spring!
                token_issuer "yourdomain.com"
                token_lifetime 3600
                # Дополнительные claims
                claims {
                    roles roles
                    user_id sub
                    email email
                }
            }
        }
    }
}

:80, :443  {
    vars {
        front-service {env.FRONT_SERVICE_URL}
        auth-service {env.AUTH_SERVICE_URL}
        user-service {env.USER_SERVICE_URL}
    }

    handle /api/auth/* {
        uri strip_prefix /api
        reverse_proxy {vars.auth-service}
    }

    @users_service_router {
        path /api/users /api/users/*
    }

    handle @users_service_router {
        uri strip_prefix /api
        reverse_proxy {vars.user-service}
    }

    handle {
        reverse_proxy {vars.front-service}
    }
}